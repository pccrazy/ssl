'use strict';

var PromiseA = require('bluebird');
var request = PromiseA.promisify(require('request'));

function checkip(ip) {
  var os = require('os');
  var ifaces = os.networkInterfaces();

  return Object.keys(ifaces).some(function (ifname) {
    return ifaces[ifname].some(function (iface) {
      return iface.address === ip;
    });
  });
}

function getExternalIp(service) {
  return request({
    url: service || 'https://api.ipify.org' || 'https://coolaj86.com/services/whatsmyip'
  }).spread(function (req, data) {
    return checkip(data) && data;
  });
}

module.exports.getExternalIp = getExternalIp;

// en0 192.168.1.101
// eth0 10.0.0.101
